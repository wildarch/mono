---
- name: Set up oracle VM
  hosts: oracle
  become: true
  tasks:
  - name: Add Caddy APT key
    become: true
    apt_key:
      url: https://dl.cloudsmith.io/public/caddy/stable/gpg.key
      file: /usr/share/keyrings/caddy-stable-archive-keyring.gpg
      state: present

  - name: Add Caddy APT repository
    become: true
    apt_repository:
      repo: deb [signed-by=/usr/share/keyrings/caddy-stable-archive-keyring.gpg] https://dl.cloudsmith.io/public/caddy/stable/deb/debian any-version main
      state: present
      filename: caddy-stable

  - name: Install packages
    apt:
      update_cache: yes
      cache_valid_time: 3600
      pkg:
        - caddy

  # TODO: IP tables
  # TODO: disable caddy, enable caddy-api
  # TODO: Apply configuration

